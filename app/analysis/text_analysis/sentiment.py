"""
Sentiment analysis module (basic implementation).
"""
import pandas as pd
import streamlit as st
import plotly.express as px


def show_sentiment_analysis(df: pd.DataFrame):
    """Display sentiment analysis interface."""
    st.subheader("ğŸ˜Š æ„Ÿæƒ…åˆ†æ")

    with st.expander("ğŸ“– ä¸€èˆ¬çš„ãªåˆ†ææ‰‹é †", expanded=False):
        st.markdown(
            """
### æ„Ÿæƒ…åˆ†æã®åŸºæœ¬çš„ãªæµã‚Œ

**1. ç›®çš„ã®æ˜ç¢ºåŒ–**
- é¡§å®¢æº€è¶³åº¦ã®æŠŠæ¡: ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®æ„Ÿæƒ…å‚¾å‘ã‚’æ•°å€¤åŒ–
- ãƒ–ãƒ©ãƒ³ãƒ‰ã‚¤ãƒ¡ãƒ¼ã‚¸ã®åˆ†æ: SNSä¸Šã®è©•åˆ¤ã‚’å®šé‡åŒ–
- ã‚¯ãƒ¬ãƒ¼ãƒ æ¤œå‡º: ãƒã‚¬ãƒ†ã‚£ãƒ–ãªæ„è¦‹ã®æ—©æœŸç™ºè¦‹
- å•†å“æ”¹å–„ã®ãƒ’ãƒ³ãƒˆ: ä¸æº€ç‚¹ã®ç‰¹å®š

**2. ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™**
- **ãƒ‡ãƒ¼ã‚¿å½¢å¼**:
  ```
  | ID | ãƒ†ã‚­ã‚¹ãƒˆåˆ—                    | æ„Ÿæƒ…ãƒ©ãƒ™ãƒ« |
  |----|------------------------------|----------|
  | 1  | ã¨ã¦ã‚‚æº€è¶³ã—ã¦ã„ã¾ã™          | ãƒã‚¸ãƒ†ã‚£ãƒ– |
  | 2  | é…é€ãŒé…ãã¦æ®‹å¿µã§ã—ãŸ        | ãƒã‚¬ãƒ†ã‚£ãƒ– |
  | 3  | æ™®é€šã®å“è³ªã§ã™                | ä¸­ç«‹     |
  ```
- **å¿…è¦ãªåˆ—**:
  - ãƒ†ã‚­ã‚¹ãƒˆåˆ—: åˆ†æå¯¾è±¡ã®æ–‡ç« 
  - æ„Ÿæƒ…ãƒ©ãƒ™ãƒ«åˆ—: äº‹å‰ã«ãƒ©ãƒ™ãƒ«ä»˜ã‘ã•ã‚ŒãŸæ„Ÿæƒ…ï¼ˆãƒã‚¸ãƒ†ã‚£ãƒ–/ãƒã‚¬ãƒ†ã‚£ãƒ–/ä¸­ç«‹ãªã©ï¼‰

**3. æ„Ÿæƒ…ãƒ©ãƒ™ãƒ«ã®ç¨®é¡**
- **2å€¤åˆ†é¡**: ãƒã‚¸ãƒ†ã‚£ãƒ– / ãƒã‚¬ãƒ†ã‚£ãƒ–
- **3å€¤åˆ†é¡**: ãƒã‚¸ãƒ†ã‚£ãƒ– / ä¸­ç«‹ / ãƒã‚¬ãƒ†ã‚£ãƒ–
- **å¤šå€¤åˆ†é¡**: å–œã³ã€æ€’ã‚Šã€æ‚²ã—ã¿ã€é©šããªã©
- **ã‚¹ã‚³ã‚¢**: -1.0ï¼ˆæœ€ãƒã‚¬ãƒ†ã‚£ãƒ–ï¼‰ã€œ +1.0ï¼ˆæœ€ãƒã‚¸ãƒ†ã‚£ãƒ–ï¼‰

**4. åˆ†æã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**
- **è¾æ›¸ãƒ™ãƒ¼ã‚¹**:
  - ãƒã‚¸ãƒ†ã‚£ãƒ–/ãƒã‚¬ãƒ†ã‚£ãƒ–å˜èªè¾æ›¸ã‚’ä½¿ç”¨
  - ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã§æ„Ÿæƒ…ã‚’åˆ¤å®š
  - å®Ÿè£…ãŒç°¡å˜ã ãŒç²¾åº¦ã¯ä¸­ç¨‹åº¦
- **æ©Ÿæ¢°å­¦ç¿’ãƒ™ãƒ¼ã‚¹**:
  - ãƒ©ãƒ™ãƒ«ä»˜ããƒ‡ãƒ¼ã‚¿ã§å­¦ç¿’
  - ã‚ˆã‚Šé«˜ç²¾åº¦ã ãŒå­¦ç¿’ãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦
- **æ·±å±¤å­¦ç¿’ãƒ™ãƒ¼ã‚¹**:
  - BERTã€GPTãªã©ã®è¨€èªãƒ¢ãƒ‡ãƒ«
  - æœ€é«˜ç²¾åº¦ã ãŒè¨ˆç®—ã‚³ã‚¹ãƒˆå¤§

**5. åˆ†æã®å®Ÿè¡Œ**
- å„ãƒ†ã‚­ã‚¹ãƒˆã«æ„Ÿæƒ…ãƒ©ãƒ™ãƒ«ã‚’ä»˜ä¸
- æ„Ÿæƒ…ã‚¹ã‚³ã‚¢ã‚’ç®—å‡º
- å…¨ä½“ã®æ„Ÿæƒ…åˆ†å¸ƒã‚’é›†è¨ˆ

**6. çµæœã®å¯è¦–åŒ–**
- æ„Ÿæƒ…ã®åˆ†å¸ƒï¼ˆå††ã‚°ãƒ©ãƒ•ã€æ£’ã‚°ãƒ©ãƒ•ï¼‰
- æ™‚ç³»åˆ—ã§ã®æ„Ÿæƒ…å¤‰åŒ–
- ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®æ„Ÿæƒ…æ¯”è¼ƒ
- ãƒ¯ãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¦ãƒ‰ï¼ˆæ„Ÿæƒ…åˆ¥ï¼‰

**7. çµæœã®è§£é‡ˆ**
- ãƒã‚¸ãƒ†ã‚£ãƒ–/ãƒã‚¬ãƒ†ã‚£ãƒ–ã®å‰²åˆ
- ç‰¹ã«ãƒã‚¬ãƒ†ã‚£ãƒ–ãªæ„è¦‹ã®å†…å®¹åˆ†æ
- æ”¹å–„ãŒå¿…è¦ãªç‚¹ã®ç‰¹å®š
- å¥½è©•ãªç‚¹ã®å¼·åŒ–

**8. æ³¨æ„ç‚¹**
- çš®è‚‰ã‚„åèªã¯èª¤åˆ¤å®šã—ã‚„ã™ã„
- æ–‡è„ˆä¾å­˜ã®æ„Ÿæƒ…ã¯æ‰ãˆã«ãã„
- ãƒ‰ãƒ¡ã‚¤ãƒ³ç‰¹æœ‰ã®è¡¨ç¾ã«å¯¾å¿œãŒå¿…è¦
- ãƒ©ãƒ™ãƒ«ä»˜ã‘ã®åŸºæº–ãŒé‡è¦ï¼ˆä¸»è¦³ãŒå…¥ã‚‹ï¼‰
- ä¸­ç«‹çš„ãªæ–‡ç« ãŒå¤šã„ã¨åˆ¤å®šãŒé›£ã—ã„

**9. ã“ã®ãƒ„ãƒ¼ãƒ«ã®ä½¿ç”¨æ–¹æ³•**
- äº‹å‰ã«æ„Ÿæƒ…ãƒ©ãƒ™ãƒ«åˆ—ã‚’ç”¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
- è‡ªå‹•çš„ãªæ„Ÿæƒ…åˆ¤å®šã¯ä»Šå¾Œã®å®Ÿè£…äºˆå®š
            """
        )

    text_cols = df.select_dtypes(include=["object"]).columns.tolist()

    if not text_cols:
        st.warning("ãƒ†ã‚­ã‚¹ãƒˆåˆ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚")
        return

    st.info("æ„Ÿæƒ…åˆ†æã«ã¯äº‹å‰ã«ãƒ©ãƒ™ãƒ«ä»˜ã‘ã•ã‚ŒãŸæ„Ÿæƒ…åˆ—ãŒå¿…è¦ã§ã™ã€‚")

    col1, col2 = st.columns(2)
    with col1:
        text_col = st.selectbox("ãƒ†ã‚­ã‚¹ãƒˆåˆ—ã‚’é¸æŠ", text_cols)
    with col2:
        sentiment_col = st.selectbox("æ„Ÿæƒ…ãƒ©ãƒ™ãƒ«åˆ—ã‚’é¸æŠ", text_cols)

    if st.button("æ„Ÿæƒ…åˆ†æã‚’å®Ÿè¡Œ", type="primary"):
        try:
            data_subset = df[[text_col, sentiment_col]].dropna()

            # Sentiment distribution
            sentiment_counts = data_subset[sentiment_col].value_counts()

            st.success("æ„Ÿæƒ…åˆ†æãŒå®Œäº†ã—ã¾ã—ãŸï¼")

            # Display distribution
            col1, col2 = st.columns(2)

            with col1:
                st.markdown("### æ„Ÿæƒ…åˆ†å¸ƒ")
                st.dataframe(sentiment_counts, use_container_width=True)

            with col2:
                st.markdown("### æ„Ÿæƒ…æ¯”ç‡")
                fig_pie = px.pie(
                    values=sentiment_counts.values,
                    names=sentiment_counts.index,
                    title="æ„Ÿæƒ…ã®åˆ†å¸ƒ"
                )
                st.plotly_chart(fig_pie, use_container_width=True)

            # Bar chart
            fig_bar = px.bar(
                x=sentiment_counts.index,
                y=sentiment_counts.values,
                labels={"x": "æ„Ÿæƒ…", "y": "ä»¶æ•°"},
                title="æ„Ÿæƒ…åˆ¥ä»¶æ•°"
            )
            st.plotly_chart(fig_bar, use_container_width=True)

            # Sample texts for each sentiment
            st.markdown("### æ„Ÿæƒ…åˆ¥ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚­ã‚¹ãƒˆ")
            for sentiment in sentiment_counts.index:
                with st.expander(f"{sentiment} ã®ã‚µãƒ³ãƒ—ãƒ«"):
                    samples = data_subset[data_subset[sentiment_col] == sentiment][text_col].head(5)
                    for i, text in enumerate(samples, 1):
                        st.text(f"{i}. {text}")

        except Exception as e:
            st.error(f"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}")
